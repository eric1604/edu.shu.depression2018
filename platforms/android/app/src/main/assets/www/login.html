<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" name="viewport" content="width=device-width, initial-scale=1, charset=utf-8">
    <title>登入</title>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <link href="./css/two.css" rel="stylesheet" type="text/css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    
    <style type="text/css">
	  #pageone{position: fixed;}
	  table{width: 90%}
    </style>

    <script type="text/javascript">
		$(document).ready(function(){$("#btnprev").click(function(){location.href="D_member.html";})});
		$(document).ready(function(){$("#btnlogin").click(login)});
		$(document).ready(function(){$("#btnsignup").click(function(){location.href = "signUp.html";})});
		$(document).ready(function(){$(".label").css({fontWeight:"bold"})});
		
		function backbtn(){
			document.addEventListener("deviceready",function(){
				document.addEventListener("backbutton",function(){
					location.href="main.html";
				},false);
			},false);
	    }
		
		function login(test)
        {
			document.addEventListener("deviceready",function(){SpinnerPlugin.activityStart("登入中...");},false);
			var userData = {ID: $("#ID").val(),PWD: $("#PWD").val()};
			if(test == 1){userData = {ID: "test",PWD: "123"};}
			else if(test == 2){userData = {ID: "TEST",PWD: "123"};}
			var data = JSON.stringify(userData);
			
			$.ajax({
                url: "http://192.192.155.108/serv/ServicePool.asmx/Login",
                contentType: "application/json; charset=utf-8",
                dataType: "text",
				data: data,
                type: "POST",
                async: false,
                success: function(check){
					var message = (JSON.parse(check)).d;
					if(message[0] == "帳號或密碼有誤，請重新檢視。"){
						document.addEventListener("deviceready",function(){
							SpinnerPlugin.activityStop();
							navigator.notification.alert(
                                message[0],
                                null,
                                '再試一次',
                                '確定'
                            );
			            },false);
					}else
					{
						window.localStorage["ID"] = userData.ID;
						window.localStorage["Name"] = message[0];
						if(message[1] != ""){window.localStorage["Image"] = message[1];}
						window.localStorage["Pet"] = message[2];
						window.localStorage["Petname"] = message[3];
						window.localStorage["Mode"] = message[4];
						window.localStorage["Privacy"] = message[5];
						if(test == 1)
						{
							location.href="main.html";
							document.addEventListener("deviceready",function(){SpinnerPlugin.activityStop();},false);
						}else if(test == 2)
						{
							location.href = "./consultant/MAIN.html";
							document.addEventListener("deviceready",function(){SpinnerPlugin.activityStop();},false);
						}
						else
						{
							document.addEventListener("deviceready",function(){
								if(window.localStorage["Mode"] == "諮商師"){location.href="./consultant/MAIN.html";}
								else{location.href="main.html";}
								SpinnerPlugin.activityStop();
					            navigator.notification.alert(
                                    '歡迎回來，你的小寵物很想你呢 ~',
                                    null,
                                    '登入成功',
                                    '確定'
                                    );
			                },false);
						}
					}
				},
                error: function(xhr, ajaxOptions, thrownError) {
					document.addEventListener("deviceready",function(){SpinnerPlugin.activityStop();},false);
					alert(xhr.readyState + " " + ajaxOptions + " " + thrownError + "\\r" + xhr.responseText);
                }
            });
        }
    </script> 
</head>
<body onLoad="backbtn()" >
    
    <div data-role="page" id="pageone">
        <div style="font-size: 22px" data-role="header" data-position="fixed" data-tap-toggle="false" data-theme="a">
           <h1 onClick="login(1)"><img style="padding-top: 4px" src="img/logintitle.png" width="100%"></h1>
		   <a id="btnprev" style="top:10px" data-role="button" ><img src="img/up.png" border="0"></a>
        </div>

        <div align="center" data-role="content" >
          <br/>
            <table align="center">
                  <tbody align="center" valign="middle" style="height: auto">
                   <tr>
                      <td class="label">帳號&nbsp;&nbsp;</td>
                      <td><input id="ID" onkeyup="value=value.replace(/[\W]/g,'')" type="text"/></td>
                   </tr>
                   <tr>
                      <td class="label">密碼&nbsp;&nbsp;</td>
                      <td><input id="PWD" type="password"/></td>
                   </tr>
                   <tr>
                	    <td colspan="2"><button type="button" id="btnlogin">登入</button></td>
                   </tr>
                  </tbody>
            </table>
			
			<br/>
			
			<table align="center" width="60%">
                  <tbody align="center" valign="middle" style="height: auto">
                   <tr>
                    <td width="40%" class="label">沒有帳號嗎 ?</td>
                    <td><button type="button" id="btnsignup">註冊新帳號</button></td>
                   </tr>
                  </tbody>
            </table>
			
        </div>                                         
           
        <table align="center" border="0">
        <tbody align="center" valign="middle" style="height: auto">
			<tr>
				<td><img onClick="login(2)" src="img/foot01.gif" width="70%"></td>
			</tr>
        </tbody>
        </table>
        </div>
</body>
</html>