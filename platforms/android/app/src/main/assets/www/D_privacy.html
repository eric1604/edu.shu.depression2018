<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" name="viewport" content="width=device-width, initial-scale=1; charset=utf-8">
    <title>隱私設定</title>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <link href="./css/two.css" rel="stylesheet" type="text/css">
    <link href="./css/all.css" rel="stylesheet" type="text/css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>

    <style type="text/css">
		.optContainer .ui-flipswitch {
            float: right;
            margin-right: 10px;
        }
		strong{font-size: 14px;}
    </style>
    
    <script type="text/javascript">
		$(document).ready(function(){$("#btnprev").click(function(){location.href="D_member.html";})});
		$(document).ready(function(){$("#btnhome").click(function(){location.href="main.html";})});
		$(document).ready(get);
		
		var ok = 0;
		
		function backbtn(){
			document.addEventListener("deviceready",function(){
				document.addEventListener("backbutton",function(){
					location.href="D_member.html";
				},false);
			},false);
		}
		
		function get()
		{
			$("#BSRS5").val(window.localStorage["Privacy"].charAt(0)).flipswitch("refresh");
			$("#UTB").val(window.localStorage["Privacy"].charAt(1)).flipswitch("refresh");
			$("#Diary").val(window.localStorage["Privacy"].charAt(2)).flipswitch("refresh");
			$("#Sleep").val(window.localStorage["Privacy"].charAt(3)).flipswitch("refresh");
			ok = 1;
		}
		
		function update()
        {
			if(ok == 1)
			{
				var set = $("#BSRS5").val() + $("#UTB").val() + $("#Diary").val() + $("#Sleep").val();
			    var setting = {ID: window.localStorage["ID"],PRIVACY: set};
			    var data = JSON.stringify(setting);
			     
			    $.ajax({
                    url: "http://192.192.155.108/serv/ServicePool.asmx/Privacy",
                    contentType: "application/json; charset=utf-8",
                    dataType: "text",
			    	data: data,
                    type: "POST",
                    async: false,
                    success: function(check){
			    		var name = (JSON.parse(check)).d;
			    		if(name == set){window.localStorage["Privacy"] = set;}
			    		else
			    		{
			    			document.addEventListener("deviceready",function(){
			                    navigator.notification.alert(
                                    '伺服器連線錯誤 !',
                                    function(){location.reload();},
                                    '錯誤',
                                    '確定'
                                );
			                },false);
			    		}
			    	},
                    error: function(xhr, ajaxOptions, thrownError) {
			    		alert(xhr.readyState + " " + ajaxOptions + " " + thrownError + "\\r" + xhr.responseText);
                    }
                });
			}
        }
	</script>

</head>
<body onLoad="backbtn()">
    <div data-role="page" id="pageone">
        <div style="font-size:22px" data-role="header" data-position="fixed" data-tap-toggle="false" data-theme="a">
            <h1><img style="padding-top: 4px" src="img/memberchangtitlle.png" width="100%"></h1>
			<a id="btnprev" style="top:12px" data-role="button" ><img src="img/up.png" border="0"></a>
            <a id="btnhome" style="top:10px" data-role="button" ><img src="img/home.png" border="0"></a>
        </div>
        
        <div class="optContainer" data-role="content">
			<strong>您可開放相關資料給我們的諮商師做關懷及追蹤。<br/>透過資料的分析，在您需要幫助時提出協助。<br/>設定可以隨時更改。</strong>
			<ul data-role=listview data-inset="true">
				<li data-role="list-divider">心靈觀測</li>
				<li>
					<snap>心情檢測相關數據</snap>
					<select id="BSRS5" data-role="flipswitch" >
						<option value="0">關</option><option value="1">開</option>
					</select>
				</li>
				<li>
					<snap>憂鬱測量相關數據</snap>
					<select id="UTB" data-role="flipswitch" onChange="update()" >
						<option value="0">關</option><option value="1">開</option>
					</select>
				</li>
			</ul>
			<ul data-role=listview data-inset="true">
				<li data-role="list-divider">日記小築</li>
				<li>
					<snap>您的日記</snap>
					<select id="Diary" data-role="flipswitch" onChange="update()" >
						<option value="0">關</option><option value="1">開</option>
					</select>
				</li>
			</ul>
			<ul data-role=listview data-inset="true">
				<li data-role="list-divider">睡眠救星</li>
				<li>
					<snap>睡眠品質與生理數據</snap>
					<select id="Sleep" data-role="flipswitch" onChange="update()" >
						<option value="0">關</option><option value="1">開</option>
					</select>
				</li>
			</ul>
        </div>
       
        <div data-role="footer" data-position="fixed" data-tap-toggle="false" data-theme="a">
			<div data-role="navbar">
            <ul>
            <li><a onClick="javascript: location.href='C_measurement.html'" title="心情測量表"><img height="30" src="img/hert.png"><br>測量</a></li>
            <li><a onClick="javascript: location.href='A_pipeline.html'" title="諮詢管道"><img height="30" src="img/consult.png"><br>諮詢</a></li>
            <li><a onClick="javascript: location.href='B_diary.html'" title="日記管理"><img height="30" src="img/diary.png"><br>日記</a></li>
            <li><a onClick="javascript: location.href='E_sleep.html'" title="睡眠監測"><img height="30" src="img/sleep.png"><br>睡眠</a></li>
            </ul>
            </div>
        </div>

        </div>
       
</body>
</html>

