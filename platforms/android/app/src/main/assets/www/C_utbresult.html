<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" name="viewport" content="width=device-width, initial-scale=1; charset=utf-8">
    <title>憂鬱測量</title>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <link href="./css/two.css" rel="stylesheet" type="text/css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>

    <style type="text/css">
		#pageone{position: fixed;}
		td{text-align: center;}
	  	strong{font-size: 25px;background-color: aquamarine;}
	  	#score{font-size: 72px;}
	  	#info{font-size: 18px;}
	  	#sco{font-size: 20px;}
		span{font-size: 12px;}
  	</style>
    
    <script type="text/javascript">
		$(document).ready(function(){$("#btnexit").click(function(){location.href="C_measurement.html";})});
		$(document).ready(function(){
			if(window.localStorage["Privacy"].charAt(1) == "1"){document.getElementById("i").innerHTML = I[0];}
			else{document.getElementById("i").innerHTML = I[1];}
		});
		
		var I = ["會開放予專業諮商師追蹤及提供協助。","不開放予諮商師追蹤。"];
		
		function backbtn(){
			document.addEventListener("deviceready",function(){
				document.addEventListener("backbutton",function(e){
					e.preventDefault();
				},false);
				UTBresult();
			},false);
		}
    	
		function UTBresult()
		{
			if(window.localStorage["ID"] != ""){document.querySelectorAll("tr")[4].style.visibility = "visible";}
			
			document.getElementById("score").innerHTML = window.localStorage["UTBscore"];
			var date = new Date();
			var month = date.getMonth()+1;
			var time = date.getFullYear() + "-" + month + "-" + date.getDate() + " " + date.getHours() + ":" + date.getMinutes();
			var userData = {TYPE: "UTB",ID: window.localStorage["ID"],TIME: time,SCORE: window.localStorage["UTBscore"]};
			var data = JSON.stringify(userData);
			
			$.ajax(
				{
                url: "http://192.192.155.108/serv/ServicePool.asmx/FINALresult",
                contentType: "application/json; charset=utf-8",
                dataType: "text",
				data: data,
                type: "POST",
                async: false,
                success: function(check){
					var message = (JSON.parse(check)).d;
					document.getElementById("info").innerHTML = message;
					SpinnerPlugin.activityStop();
				},
                error: function(xhr, ajaxOptions, thrownError) {
					SpinnerPlugin.activityStop();
					if(thrownError.toString().slice(0,12) == "NetworkError")
					{
						document.addEventListener("deviceready",function(){
			                navigator.notification.alert(
                                '伺服器連線失敗，請檢查網路。',
                                null,
                                '⚠️ 錯誤',
                                '確定'
                            );
			            },false);
					}else
					{
						alert("[Ready State] " + xhr.readyState + "\n[Ajax Options] " + ajaxOptions + "\n[Thrown Error]\n" + thrownError + "\n\n[Response Text] " + xhr.responseText);
					}
                }
            });
		}
    </script>
</head>

<body onLoad="backbtn()">

 	<div data-role="page" id="pageone">
       <div data-role="header" data-position="fixed" data-tap-toggle="false" data-theme="a" font style="font-size:22px">
       <h1><img style="padding-top: 4px" src="img/depresstitle.webp" width="100%"></h1>
        </div>
            <table height="470px" align="center" width="90%">
				<tr height="10%">
					<td><img src="img/score01.webp" width="30%"></td>
				</tr>
				<tr height="25%">
					<td><font id="score"></font><span id="sco">分</span></td>
				</tr>
				<tr height="10%">
					<td><img src="img/score02.webp" width="30%"></td>
				</tr>
				<tr height="40%">
					<td><font id="info"></font></td>
				</tr>
				<tr style="visibility: hidden">
					<td><span>您的檢測相關資料將<span id="i"></span><br/>如欲調整相關設定，請至會員><a onClick="javascript: location.href='D_privacy.html'">諮商設定</a>。</span></td>
				</tr>
				<tr>
					<td><input type="button" id="btnexit" value="完成"></td>
				</tr>
			</table>
     </div>
</body>
</html>